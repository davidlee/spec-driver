---
id: IP-004
slug: phase-management-implementation
name: Implementation Plan - Phase Management Implementation
created: '2025-11-02'
updated: '2025-11-02'
status: draft
kind: plan
aliases: []
---

```yaml supekku:plan.overview@v1
schema: supekku.plan.overview
version: 1
plan: IP-004
delta: DE-004
revision_links:
  aligns_with: []
specs:
  primary:
    - PROD-006
  collaborators: []
requirements:
  targets:
    - PROD-006.FR-001
    - PROD-006.FR-002
    - PROD-006.FR-003
    - PROD-006.FR-004
    - PROD-006.FR-005
    - PROD-006.NF-001
    - PROD-006.NF-002
  dependencies: []
phases:
  - id: IP-004.PHASE-01
    name: Phase 01 - Create Phase Command
    objective: >-
      Implement `create phase` command with auto-numbering, metadata population,
      and template rendering. Covers core phase creation logic.
    entrance_criteria:
      - DE-004 delta approved
      - PROD-006 spec reviewed
    exit_criteria:
      - create_phase() function implemented in creation.py
      - CLI command wired in cli/create.py
      - VT-PHASE-001, VT-PHASE-002, VT-PHASE-004 passing
      - Manual test: create phase for IP-002 works

  - id: IP-004.PHASE-02
    name: Phase 02 - Enhanced Display & Validation
    objective: >-
      Enhance delta display formatter to show phases. Add schema validation
      for phase.overview blocks during sync.
    entrance_criteria:
      - Phase 01 complete
      - Phase creation working and tested
    exit_criteria:
      - format_delta_details() shows phase summaries
      - Schema validation enforces phase.overview correctness
      - VT-PHASE-003, VT-PHASE-005 passing
      - Manual test: show delta DE-002 displays all phases

  - id: IP-004.PHASE-03
    name: Phase 03 - Verification & Polish
    objective: >-
      Complete verification artifacts (performance, UX review), ensure quality
      gates pass, update documentation.
    entrance_criteria:
      - Phase 02 complete
      - All core functionality working
    exit_criteria:
      - VA-PHASE-001 (performance) complete
      - VA-PHASE-002 (UX review) complete
      - All tests + linters passing
      - Documentation updated

  - id: IP-004.PHASE-04
    name: Phase 04 - Plan Metadata Auto-Update
    objective: >-
      Implement automatic plan frontmatter updates when creating phases,
      ensuring `show delta --json` reflects newly created phases immediately.
    entrance_criteria:
      - Phase 01 complete
      - Understanding of plan.overview block structure
    exit_criteria:
      - create_phase() updates plan.overview phases array
      - VT-PHASE-006 passing (plan metadata update tests)
      - Manual test - create phase updates JSON output
      - All tests + linters passing
```

```yaml supekku:verification.coverage@v1
schema: supekku.verification.coverage
version: 1
subject: IP-004
entries:
  - artefact: VT-PHASE-001
    kind: VT
    requirement: PROD-006.FR-001
    phase: IP-004.PHASE-01
    status: planned
    notes: Unit tests for phase file creation with valid frontmatter

  - artefact: VT-PHASE-002
    kind: VT
    requirement: PROD-006.FR-002
    phase: IP-004.PHASE-01
    status: planned
    notes: Tests for automatic phase numbering (01, 02, 03...)

  - artefact: VT-PHASE-004
    kind: VT
    requirement: PROD-006.FR-004
    phase: IP-004.PHASE-01
    status: planned
    notes: Tests for metadata auto-population (phase ID, plan ID, delta ID)

  - artefact: VT-PHASE-003
    kind: VT
    requirement: PROD-006.FR-003
    phase: IP-004.PHASE-02
    status: planned
    notes: Formatter tests for enhanced delta display with phases

  - artefact: VT-PHASE-005
    kind: VT
    requirement: PROD-006.FR-005
    phase: IP-004.PHASE-02
    status: planned
    notes: Schema validation tests for phase.overview blocks

  - artefact: VT-PHASE-006
    kind: VT
    requirement: PROD-006.FR-004
    phase: IP-004.PHASE-04
    status: planned
    notes: Tests for automatic plan frontmatter update when creating phases

  - artefact: VA-PHASE-001
    kind: VA
    requirement: PROD-006.NF-001
    phase: IP-004.PHASE-03
    status: planned
    notes: Performance benchmark - phase creation <2sec for 20 phases

  - artefact: VA-PHASE-002
    kind: VA
    requirement: PROD-006.NF-002
    phase: IP-004.PHASE-03
    status: planned
    notes: UX review of delta display with 1/3/5/10 phases
```

## 1. Summary
- **Delta**: DE-004 - Phase Management Implementation
- **Specs Impacted**: PROD-006 (primary), SPEC-003, SPEC-006, SPEC-054 (updates)
- **Problems / Issues**: Manual phase creation error-prone, no visibility, no validation, plan metadata not auto-updated
- **Desired Outcome**: `create phase` command working, enhanced delta display, schema validation active, plan frontmatter automatically updated

## 2. Context & Constraints
- **Current Behaviour**: Manual phase creation from template, no tooling support, no display in show delta
- **Target Behaviour**: PROD-006 requirements - automated creation, visible phases, validated metadata
- **Dependencies**: None - self-contained implementation
- **Constraints**: Solo developer, maintain skinny CLI pattern, no breaking changes to existing phases

## 3. Gate Check
- [x] Backlog items linked and prioritised (none needed)
- [x] Spec(s) updated - PROD-006 complete and synced
- [x] Test strategy identified (7 VT/VA artifacts mapped)
- [x] Workspace/config changes assessed (no config changes needed)

## 4. Phase Overview
| Phase | Objective | Entrance Criteria | Exit Criteria / Done When | Phase Sheet |
| --- | --- | --- | --- | --- |
| Phase 01 - Create Phase Command | Implement creation logic with auto-numbering | DE-004 approved, PROD-006 reviewed | create_phase() working, VT-001/002/004 passing | `phases/phase-01.md` |
| Phase 02 - Display & Validation | Enhanced formatter + schema validation | Phase 01 complete | show delta displays phases, VT-003/005 passing | `phases/phase-02.md` |
| Phase 03 - Verification & Polish | Complete VA artifacts, quality gates | Phase 02 complete | All tests pass, docs updated | `phases/phase-03.md` |
| Phase 04 - Plan Metadata Auto-Update | Auto-update plan frontmatter on phase creation | Phase 01 complete, plan.overview structure understood | Plan metadata updated, VT-006 passing, JSON output consistent | `phases/phase-04.md` |

## 5. Phase Detail Snapshot
- **Research Notes**: `DE-004/notes.md` - Track design decisions and discoveries
- **Design Revision**: None needed (PROD-006 is the design)
- **Active Phase Sheet**: `phases/phase-01.md` (start here)
- **Parallelizable Work**:
  - [P] VT-PHASE-001 and VT-PHASE-002 can run in parallel during Phase 01
  - [P] Formatter tests and validation tests independent in Phase 02
- **Plan Updates**: Update if scope changes (e.g., schema validation more complex than expected)

## 6. Testing & Verification Plan

**Phase 01 - Create Phase Command**:
- **VT-PHASE-001**: Phase Creation Unit Tests
  - Test: create first phase for plan → phase-01.md created
  - Test: create phase with all metadata → frontmatter valid
  - Test: invalid plan ID → error raised
  - Test: empty phase name → error raised
  - Location: `supekku/scripts/lib/changes/creation_test.py` (enhance)

- **VT-PHASE-002**: Auto-Numbering Tests
  - Test: first phase → PHASE-01
  - Test: second phase → PHASE-02 (increments)
  - Test: gap in numbering → warning, but succeeds
  - Test: phase-01 exists → create phase-02 correctly
  - Location: Same as VT-PHASE-001

- **VT-PHASE-004**: Metadata Population Tests
  - Test: phase ID matches pattern `IP-XXX.PHASE-NN`
  - Test: plan ID from --plan flag
  - Test: delta ID looked up from plan
  - Test: name from positional arg
  - Location: Same as VT-PHASE-001

**Phase 02 - Display & Validation**:
- **VT-PHASE-003**: Formatter Tests
  - Test: delta with 0 phases → "Plan: IP-XXX (0 phases)"
  - Test: delta with 3 phases → shows all with truncated objectives
  - Test: objective truncation at 80 chars
  - Test: phase ID and name formatted correctly
  - Location: `supekku/scripts/lib/formatters/change_formatters_test.py` (enhance)

- **VT-PHASE-005**: Schema Validation Tests
  - Test: valid phase.overview → sync succeeds
  - Test: missing required field → error raised
  - Test: wrong schema version → error raised
  - Test: malformed YAML → error raised
  - Location: Schema validation tests (may be in blocks/ or validation/)

**Phase 03 - Verification & Analysis**:
- **VA-PHASE-001**: Performance Benchmark
  - Create plan with 0 phases
  - Time creation of phases 1-20
  - Verify all < 2 seconds
  - Manual analysis during Phase 03

- **VA-PHASE-002**: UX Review
  - Create test deltas with 1, 3, 5, 10 phases
  - Run show delta for each
  - Verify readability and information scannability
  - Document truncation strategy effectiveness
  - Manual review during Phase 03

**Rollback Plan**:
- Simple: git revert to pre-implementation commit
- No migration needed - new capability only

## 7. Risks & Mitigations
| Risk | Mitigation | Owner |
| --- | --- | --- |
| Phase numbering conflicts with manual files | Scan filesystem for actual files, not just frontmatter | Dev |
| Template rendering breaks on special characters | Escape user input, test with edge cases | Dev |
| Formatter makes delta unreadable with many phases | Truncate objectives, test with 10 phases | Dev |
| Schema validation too strict | Follow existing patterns, test with real phase files | Dev |

## 8. Open Questions & Decisions
- [x] Should phase creation update plan frontmatter? → No (manual sync)
- [x] Phase numbering format? → Zero-padded two digits (PHASE-01)
- [x] Error vs warning for numbering gaps? → Warning (flexibility)

## 9. Progress Tracking
- [ ] Phase 01 complete (create phase command)
- [ ] Phase 02 complete (display & validation)
- [ ] Phase 03 complete (verification & polish)
- [ ] Verification gates passed

## 10. Notes / Links
- Reference implementation: IP-002 (has 3 phases created manually)
- Template: `supekku/templates/phase.md`
- Existing patterns: `create_delta()` in `supekku/scripts/lib/changes/creation.py`
- Schema: `phase.overview` already defined in schema registry
