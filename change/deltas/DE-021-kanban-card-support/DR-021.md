---
id: DR-021
slug: kanban-card-support
name: Design Revision - Card support (kanban board)
created: '2026-02-03'
updated: '2026-02-03'
status: draft
kind: design_revision
aliases: []
owners: []
relations:
- type: implements
  target: DE-021
delta_ref: DE-021
source_context: []
code_impacts: []
verification_alignment: []
design_decisions: []
open_questions: []
---

# DR-021 – Card support (kanban board)

## 1. Executive Summary
- **Delta**: [DE-021](./DE-021.md)
- **Status**: draft
- **Owners / Team**: TBD
- **Last Updated**: 2026-02-03
- **Synopsis**: Add first-class “card” artifact support for Markdown cards under `kanban/`, with ID-based resolution and CLI workflows.

## 2. Problem & Constraints
**Current Behaviour**
- Cards exist as Markdown files, but there’s no unified, ID-aware CLI workflow in SpecDriver.
- ID linking is brittle across folder moves (e.g. `kanban/backlog` → `kanban/doing`).

**Drivers / Inputs**
- IMPR-003 – `backlog/improvements/IMPR-003-kanban-support/IMPR-003.md`
- ADR-001 – `specify/decisions/ADR-001-use-spec-driver-to-build-spec-driver.md`
- Prior art: `deck_of_dwarf/kanban` `Justfile:new-card` (scan + template copy)

**Constraints / Guardrails**
- Markdown-first: avoid mandatory YAML frontmatter for cards.
- Keep CLI thin; formatting stays in formatters; business logic stays in domain package.
- Preserve user-editable templates: only rewrite H1 + `Created:` line on create.

**Out of Scope**
- Move/rename helpers (`git mv` wrapper, normalize filenames).
- Repo-wide “refs” (content search) command (separate delta).

## 3. Architecture Intent
**Target Outcomes**
- New `card` artifact type (ID prefix `T`) with:
  - create/list/show/find commands
  - robust ID→path resolution (default `kanban/**`, `--anywhere` option)
  - minimal, tolerant metadata parsing from Markdown (H1 + `Created:`)

**Guiding Principles**
- Do the simplest thing that supports ID stability and searchability.
- Prefer explicit ambiguity errors over “best guess” selection.
- Keep search behaviours obvious and testable (filename patterns are deterministic).

## 4. Code Impact Summary
| Path | Current State | Target State |
| --- | --- | --- |
| `supekku/scripts/lib/cards/models.py` | N/A | Card dataclass (id/title/lane/path/created + optional links) |
| `supekku/scripts/lib/cards/registry.py` | N/A | Discovery, ID allocation, creation, resolution, matching |
| `supekku/scripts/lib/formatters/card_formatters.py` | N/A | Pure table/json/tsv formatters for cards |
| `supekku/cli/create.py` | No `create card` | Add `create card` command (thin orchestration) |
| `supekku/cli/list.py` | No `list cards` | Add `list cards` command |
| `supekku/cli/show.py` | No `show card` | Add `show card` command (`-q`, `--anywhere`) |
| `supekku/cli/find.py` | N/A | Add `find card` command (repo-wide filename matches) |
| `supekku/cli/main.py` | No `find` group | Register `find` group |
| `supekku/scripts/lib/formatters/__init__.py` | No exports | Export card formatter functions |
| Tests | N/A | Domain/formatter/CLI tests for card behaviours |

> Capture each affected component with concise before/after statements. Align this table with the `code_impacts` frontmatter entries.

## 5. Verification Alignment
| Verification | Impact | Notes |
| --- | --- | --- |
| VT-021-001 | new | ID parsing + lane detection + ambiguity rules |
| VT-021-002 | new | next-ID allocation scans all lanes |
| VT-021-003 | new | create card copies template and rewrites only H1/Created |
| VT-021-004 | new | `show card -q` path-only behaviour |
| VT-021-005 | new | `find card` repo-wide filename matching |
| VT-021-006 | new | `list cards` output formats |
| VH-021-001 | new | manual UX sanity (create/list/show/find) |

> Keep the table in sync with `verification_alignment` metadata so tooling can audit impacts.

## 6. Supporting Context
- **Related Deltas**: none
- **Specs / PRODs**: none explicitly targeted (internal tooling delta)

## 7. Design Decisions & Trade-offs
- **Command naming**: use `card` (not `kanban`) for ergonomics.
- **Filename as primary key**: ID derives from filename (`T###-*.md`), not frontmatter.
- **Default scope for `show card`**: `kanban/**` to reduce ambiguity; `--anywhere` is explicit.
- **Template rewriting**: rewrite only first H1 + `Created:` to preserve user customization.

## 8. Open Questions
- [ ] Should we parse optional `Depends:`/`Related:` sections now, or defer until after core commands land?
- [ ] Should `create card` support `--lane doing|done|...` in v1 (default backlog)?

## 11. Next Actions (for implementation planning)

- Create Phase 1 sheet when ready: `uv run spec-driver create phase --plan IP-021`
- Implement in phases:
  - Domain: `supekku/scripts/lib/cards/`
  - Formatter: `supekku/scripts/lib/formatters/card_formatters.py`
  - CLI: `supekku/cli/create.py`, `supekku/cli/list.py`, `supekku/cli/show.py`, `supekku/cli/find.py`, `supekku/cli/main.py`
- Use the VT/VH IDs listed in [DE-021](./DE-021.md) and [IP-021](./IP-021.md) to drive test-first work.

## 9. Rollout & Operational Notes
- **Migration / Backfill**: none (filesystem-only behaviour)
- **Recovery / Rollback**: revert CLI + domain additions; existing `kanban/` files remain untouched

## 10. References & Links
- IMPR-003 – `backlog/improvements/IMPR-003-kanban-support/IMPR-003.md`
- ADR-001 – `specify/decisions/ADR-001-use-spec-driver-to-build-spec-driver.md`

> Keep this document as the living design record for the delta. Update frontmatter fields (`owners`, `code_impacts`, `verification_alignment`, `design_decisions`, `open_questions`) as the design evolves.
