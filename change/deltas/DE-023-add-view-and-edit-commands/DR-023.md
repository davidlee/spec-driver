---
id: DR-023
slug: add-view-and-edit-commands
name: Design Revision - Add view and edit commands
created: '2026-02-04'
updated: '2026-02-04'
status: draft
kind: design_revision
aliases: []
owners: []
relations:
- type: implements
  target: DE-023
delta_ref: DE-023
source_context:
  - supekku/cli/main.py
  - supekku/cli/common.py
code_impacts:
  - path: supekku/cli/view.py
    current: Does not exist
    target: New command group with subcommands for all artifact types
  - path: supekku/cli/edit.py
    current: Does not exist
    target: New command group with subcommands for all artifact types
  - path: supekku/cli/common.py
    current: Common CLI utilities
    target: Add get_pager(), get_editor(), open_in_pager(), open_in_editor()
  - path: supekku/cli/main.py
    current: Registers show, list, create, etc.
    target: Register view and edit command groups
verification_alignment:
  - id: VT-023-001
    impact: new
    notes: Test view command with mocked pager
  - id: VT-023-002
    impact: new
    notes: Test edit command with mocked editor
design_decisions:
  - id: DEC-023-01
    summary: Separate modules for view and edit (not combined)
  - id: DEC-023-02
    summary: Reuse path resolution from registries
open_questions: []
---

# DR-023 – Add view and edit commands

## 1. Executive Summary

- **Delta**: [DE-023](./DE-023.md)
- **Status**: draft
- **Last Updated**: 2026-02-04
- **Synopsis**: Add `view` and `edit` top-level commands for opening artifacts in pager/editor

## 2. Problem & Constraints

- **Current Behaviour**: No way to open artifacts directly; must find path manually
- **Drivers / Inputs**: PROD-013.FR-003, FR-004
- **Constraints / Guardrails**:
  - Unix conventions: respect $PAGER, $EDITOR, $VISUAL
  - Graceful fallbacks (less → more; vi as last resort)
  - Clear errors when no pager/editor available
- **Out of Scope**: Multi-file viewing, Windows support (works if tools exist)

## 3. Architecture Intent

- **Target Outcomes**:
  - FR-003: `view <type> <id>` opens in pager
  - FR-004: `edit <type> <id>` opens in editor
- **Guiding Principles**:
  - Mirror structure of `show` command (same subcommands)
  - Reuse registry path resolution
  - Keep helpers in common.py for reuse

## 4. Code Impact Summary

| Path | Current State | Target State |
| --- | --- | --- |
| `supekku/cli/view.py` | N/A | New file with view command group |
| `supekku/cli/edit.py` | N/A | New file with edit command group |
| `supekku/cli/common.py` | CLI utilities | + pager/editor helpers |
| `supekku/cli/main.py` | Registers commands | + view, edit |

## 5. Verification Alignment

| Verification | Impact | Notes |
| --- | --- | --- |
| VT-023-001 | new | view command tests |
| VT-023-002 | new | edit command tests |

## 6. Supporting Context

- **Related Specs**: PROD-013 – CLI Artifact File Access
- **Related Deltas**: DE-022 (--path flag, independent)

## 7. Design Decisions & Trade-offs

**DEC-023-01: Separate modules**
- Decision: Create `view.py` and `edit.py` as separate modules
- Rationale: Follows existing pattern (show.py, list.py, create.py)
- Alternative: Single `open.py` with `--pager`/`--editor` flags
- Consequence: More files but clearer intent

**DEC-023-02: Reuse registry resolution**
- Decision: Use existing registry classes to resolve paths
- Rationale: Already have path resolution logic
- Consequence: Consistent behavior with `show` command

**DEC-023-03: Subcommand structure**
- Decision: `view adr`, `view spec`, etc. (mirrors `show`)
- Rationale: Consistency with existing CLI structure
- Alternative: Single command `view ADR-001` with auto-detection
- Consequence: More typing but explicit artifact type

## 8. Open Questions

None.

## 9. Rollout & Operational Notes

- **Migration**: N/A (new functionality)
- **Observability**: N/A (CLI tool)
- **Recovery**: N/A

## 10. Implementation Pattern

### common.py additions

```python
import os
import shutil
import subprocess
from pathlib import Path

def get_pager() -> str | None:
  """Get pager command from environment or fallback."""
  if pager := os.environ.get("PAGER"):
    return pager
  for cmd in ("less", "more"):
    if shutil.which(cmd):
      return cmd
  return None

def get_editor() -> str | None:
  """Get editor command from environment or fallback."""
  for var in ("EDITOR", "VISUAL"):
    if editor := os.environ.get(var):
      return editor
  if shutil.which("vi"):
    return "vi"
  return None

def open_in_pager(path: Path) -> None:
  """Open file in pager."""
  pager = get_pager()
  if not pager:
    raise RuntimeError("No pager found. Set $PAGER or install less.")
  subprocess.run([pager, str(path)], check=True)

def open_in_editor(path: Path) -> None:
  """Open file in editor."""
  editor = get_editor()
  if not editor:
    raise RuntimeError("No editor found. Set $EDITOR or install vi.")
  subprocess.run([editor, str(path)], check=True)
```

### view.py structure

```python
import typer
from typing import Annotated
from supekku.cli.common import RootOption, open_in_pager, EXIT_SUCCESS, EXIT_FAILURE
from supekku.scripts.lib.decisions.registry import DecisionRegistry
# ... other registries

app = typer.Typer(help="View artifacts in pager")

@app.command("adr")
def view_adr(
  decision_id: Annotated[str, typer.Argument(help="Decision ID (e.g., ADR-001)")],
  root: RootOption = None,
) -> None:
  """View ADR in pager."""
  try:
    registry = DecisionRegistry(root=root)
    decision = registry.find(decision_id)
    if not decision:
      typer.echo(f"Error: Decision not found: {decision_id}", err=True)
      raise typer.Exit(EXIT_FAILURE)
    open_in_pager(decision.path)
    raise typer.Exit(EXIT_SUCCESS)
  except RuntimeError as e:
    typer.echo(f"Error: {e}", err=True)
    raise typer.Exit(EXIT_FAILURE) from e

# Similar for spec, delta, revision, requirement, policy, standard, card
```

### edit.py structure

Same as view.py but uses `open_in_editor()` instead of `open_in_pager()`.

### main.py registration

```python
from supekku.cli import view, edit

app.add_typer(view.app, name="view")
app.add_typer(edit.app, name="edit")
```
